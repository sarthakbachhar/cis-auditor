<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CIS Benchmark Audit Report - {{ target_ip }}</title>
    <style>
        :root {
            --primary-color: #1a365d;
            --secondary-color: #2b77ad;
            --success-color: #38a169;
            --danger-color: #e53e3e;
            --warning-color: #d69e2e;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--gray-800);
            background-color: var(--gray-50);
        }

        .report-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            box-shadow: var(--shadow-lg);
            min-height: 100vh;
        }

        /* Header Section */
        .report-header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            padding: 3rem 2rem;
            position: relative;
            overflow: hidden;
        }

        .report-header::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 50%;
            height: 100%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="2" fill="rgba(255,255,255,0.1)"/><circle cx="20" cy="20" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="80" cy="30" r="1.5" fill="rgba(255,255,255,0.1)"/><circle cx="30" cy="80" r="1" fill="rgba(255,255,255,0.1)"/></svg>') repeat;
            opacity: 0.3;
        }

        .header-content {
            position: relative;
            z-index: 1;
        }

        .report-title {
            font-size: 2.75rem;
            font-weight: 300;
            margin-bottom: 0.5rem;
            letter-spacing: -0.02em;
        }

        .report-subtitle {
            font-size: 1.25rem;
            opacity: 0.9;
            font-weight: 300;
        }

        .compliance-badge {
            position: absolute;
            top: 2rem;
            right: 2rem;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            padding: 1rem 1.5rem;
            border-radius: 12px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .compliance-percentage {
            font-size: 2rem;
            font-weight: bold;
            display: block;
        }

        .compliance-label {
            font-size: 0.875rem;
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* Executive Summary */
        .executive-summary {
            padding: 2rem;
            background: var(--gray-50);
            border-bottom: 1px solid var(--gray-200);
        }

        .section-title {
            font-size: 1.5rem;
            color: var(--primary-color);
            margin-bottom: 1.5rem;
            font-weight: 600;
            position: relative;
            padding-left: 1rem;
        }

        .section-title::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: var(--secondary-color);
            border-radius: 2px;
        }

        .audit-metadata {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .metadata-item {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--gray-200);
            text-align: center;
        }

        .metadata-label {
            font-size: 0.875rem;
            color: var(--gray-500);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .metadata-value {
            font-size: 1.125rem;
            color: var(--gray-800);
            font-weight: 600;
        }

        .summary-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .metric-card {
            background: white;
            padding: 2rem 1.5rem;
            border-radius: 12px;
            box-shadow: var(--shadow-md);
            border-left: 4px solid;
            transition: transform 0.2s ease;
        }

        .metric-card:hover {
            transform: translateY(-2px);
        }

        .metric-card.total { border-left-color: var(--gray-500); }
        .metric-card.passed { border-left-color: var(--success-color); }
        .metric-card.failed { border-left-color: var(--danger-color); }
        .metric-card.warning { border-left-color: var(--warning-color); }

        .metric-number {
            font-size: 3rem;
            font-weight: 700;
            line-height: 1;
            margin-bottom: 0.5rem;
        }

        .metric-card.total .metric-number { color: var(--gray-600); }
        .metric-card.passed .metric-number { color: var(--success-color); }
        .metric-card.failed .metric-number { color: var(--danger-color); }

        .metric-label {
            font-size: 1rem;
            color: var(--gray-600);
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* Compliance Progress Bar */
        .compliance-section {
            padding: 2rem;
            background: white;
        }

        .compliance-bar {
            background: var(--gray-200);
            height: 24px;
            border-radius: 12px;
            overflow: hidden;
            margin: 1rem 0;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .compliance-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--success-color), #48bb78);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 0.875rem;
            transition: width 0.8s ease-out;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        }

        /* Risk Assessment */
        .risk-assessment {
            padding: 2rem;
            background: var(--gray-50);
            border-top: 1px solid var(--gray-200);
        }

        .risk-levels {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .risk-item {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--gray-200);
        }

        .risk-high { border-left: 4px solid var(--danger-color); }
        .risk-medium { border-left: 4px solid var(--warning-color); }
        .risk-low { border-left: 4px solid var(--success-color); }

        /* Filter Controls */
        .filter-section {
            padding: 1.5rem 2rem;
            background: white;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .filter-checkbox {
            width: 18px;
            height: 18px;
            accent-color: var(--secondary-color);
        }

        .filter-label {
            font-weight: 500;
            color: var(--gray-700);
            user-select: none;
            cursor: pointer;
        }

        .search-input {
            padding: 0.5rem 1rem;
            border: 2px solid var(--gray-200);
            border-radius: 6px;
            font-size: 0.875rem;
            width: 250px;
            transition: border-color 0.2s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(43, 119, 173, 0.1);
        }

        /* Results Table */
        .results-section {
            background: white;
        }

        .table-container {
            overflow-x: auto;
        }

        .results-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        .results-table th {
            background: var(--gray-100);
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            color: var(--gray-700);
            border-bottom: 2px solid var(--gray-200);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .results-table td {
            padding: 1rem;
            border-bottom: 1px solid var(--gray-200);
            vertical-align: top;
        }

        .results-table tbody tr {
            transition: background-color 0.15s ease;
        }

        .results-table tbody tr:hover {
            background-color: var(--gray-50);
        }

        .result-row.result-failed {
            border-left: 4px solid var(--danger-color);
        }

        .result-row.result-passed {
            border-left: 4px solid var(--success-color);
        }

        /* Check ID Styling */
        .check-id {
            font-family: 'Courier New', monospace;
            background: var(--gray-100);
            padding: 0.5rem;
            border-radius: 4px;
            border-left: 3px solid var(--secondary-color);
            font-size: 0.85rem;
            font-weight: 500;
            color: var(--gray-800);
        }

        .check-description {
            margin-top: 0.5rem;
            color: var(--gray-600);
            font-size: 0.875rem;
        }

        /* Status Badges */
        .status-badge {
            display: inline-flex;
            align-items: center;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            gap: 0.375rem;
        }

        .status-badge::before {
            content: '';
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .status-passed {
            background: rgba(56, 161, 105, 0.1);
            color: var(--success-color);
            border: 1px solid rgba(56, 161, 105, 0.2);
        }

        .status-passed::before {
            background: var(--success-color);
        }

        .status-failed {
            background: rgba(229, 62, 62, 0.1);
            color: var(--danger-color);
            border: 1px solid rgba(229, 62, 62, 0.2);
        }

        .status-failed::before {
            background: var(--danger-color);
        }

        /* Remediation Styling */
        .remediation {
            background: var(--gray-50);
            border: 1px solid var(--gray-200);
            border-left: 4px solid var(--warning-color);
            border-radius: 6px;
            padding: 1rem;
            font-family: 'Courier New', monospace;
            font-size: 0.8rem;
            line-height: 1.5;
            white-space: pre-wrap;
            word-break: break-word;
            color: var(--gray-700);
        }

        .no-remediation {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--success-color);
            font-weight: 500;
        }

        .no-remediation::before {
            content: 'âœ“';
            font-weight: bold;
        }

        /* Footer */
        .report-footer {
            background: var(--gray-800);
            color: var(--gray-300);
            padding: 2rem;
            text-align: center;
        }

        .footer-content {
            max-width: 800px;
            margin: 0 auto;
        }

        .footer-title {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: white;
        }

        .footer-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }

        .footer-item {
            text-align: center;
        }

        .footer-disclaimer {
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--gray-600);
            font-size: 0.875rem;
            opacity: 0.8;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .report-container {
                margin: 0;
                box-shadow: none;
            }

            .report-header {
                padding: 2rem 1rem;
            }

            .report-title {
                font-size: 2rem;
            }

            .compliance-badge {
                position: static;
                margin-top: 1rem;
                align-self: flex-start;
            }

            .executive-summary,
            .compliance-section,
            .risk-assessment {
                padding: 1.5rem 1rem;
            }

            .audit-metadata,
            .summary-metrics {
                grid-template-columns: 1fr;
            }

            .filter-section {
                padding: 1rem;
                flex-direction: column;
                align-items: stretch;
            }

            .search-input {
                width: 100%;
            }

            .results-table th,
            .results-table td {
                padding: 0.75rem 0.5rem;
                font-size: 0.8rem;
            }

            .footer-details {
                grid-template-columns: 1fr;
                text-align: center;
            }
        }

        /* Print Styles */
        @media print {
            .filter-section {
                display: none;
            }

            .report-container {
                box-shadow: none;
                max-width: none;
            }

            .compliance-badge {
                break-inside: avoid;
            }

            .metric-card,
            .result-row {
                break-inside: avoid;
            }

            .results-table {
                font-size: 0.8rem;
            }

            .results-table th,
            .results-table td {
                padding: 0.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="report-container">
        <!-- Header Section -->
        <header class="report-header">
            <div class="header-content">
                <h1 class="report-title">CIS Benchmark Audit Report</h1>
                <p class="report-subtitle">Security Compliance Assessment</p>
            </div>
            <div class="compliance-badge">
                <span class="compliance-percentage">{{ compliance_percentage }}%</span>
                <span class="compliance-label">Compliant</span>
            </div>
        </header>

        <!-- Executive Summary -->
        <section class="executive-summary">
            <h2 class="section-title">Executive Summary</h2>
            
            <div class="audit-metadata">
                <div class="metadata-item">
                    <div class="metadata-label">Target System</div>
                    <div class="metadata-value">{{ target_ip }}</div>
                </div>
                <div class="metadata-item">
                    <div class="metadata-label">Audit Level</div>
                    <div class="metadata-value">{{ audit_level }}</div>
                </div>
                <div class="metadata-item">
                    <div class="metadata-label">Duration</div>
                    <div class="metadata-value">{{ duration }}</div>
                </div>
                <div class="metadata-item">
                    <div class="metadata-label">Report Date</div>
                    <div class="metadata-value">{{ date_time }}</div>
                </div>
            </div>

            <div class="summary-metrics">
                <div class="metric-card total">
                    <div class="metric-number">{{ total_checks }}</div>
                    <div class="metric-label">Total Controls</div>
                </div>
                <div class="metric-card passed">
                    <div class="metric-number">{{ passed_checks }}</div>
                    <div class="metric-label">Compliant</div>
                </div>
                <div class="metric-card failed">
                    <div class="metric-number">{{ failed_checks }}</div>
                    <div class="metric-label">Non-Compliant</div>
                </div>
            </div>
        </section>

        <!-- Compliance Progress -->
        <section class="compliance-section">
            <h2 class="section-title">Compliance Overview</h2>
            <div class="compliance-bar">
                <div class="compliance-fill" style="width: {{ compliance_percentage }}%">
                    {{ compliance_percentage }}% Security Compliance
                </div>
            </div>
            <p style="color: var(--gray-600); margin-top: 1rem;">
                This assessment evaluates {{ total_checks }} security controls against industry-standard CIS benchmarks. 
                A compliance rate of {{ compliance_percentage }}% indicates the current security posture of the target system.
            </p>
        </section>

        <!-- Filter Controls -->
        <section class="filter-section">
            <div class="filter-group">
                <input type="checkbox" id="showPassed" class="filter-checkbox" checked>
                <label for="showPassed" class="filter-label">Show Compliant</label>
            </div>
            <div class="filter-group">
                <input type="checkbox" id="showFailed" class="filter-checkbox" checked>
                <label for="showFailed" class="filter-label">Show Non-Compliant</label>
            </div>
            <input type="text" id="searchInput" class="search-input" placeholder="Search controls...">
        </section>

        <!-- Detailed Results -->
        <section class="results-section">
            <div class="table-container">
                <table class="results-table" id="resultsTable">
                    <thead>
                        <tr>
                            <th style="width: 40%;">Control</th>
                            <th style="width: 15%;">Status</th>
                            <th style="width: 45%;">Remediation</th>
                        </tr>
                    </thead>
                    <tbody>
                        {{ results_rows }}
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Footer -->
        <footer class="report-footer">
            <div class="footer-content">
                <h3 class="footer-title">CIS Benchmark Security Assessment</h3>
                <div class="footer-details">
                    <div class="footer-item">
                        <strong>Target:</strong> {{ target_ip }}
                    </div>
                    <div class="footer-item">
                        <strong>Level:</strong> {{ audit_level }}
                    </div>
                    <div class="footer-item">
                        <strong>Duration:</strong> {{ duration }}
                    </div>
                    <div class="footer-item">
                        <strong>Generated:</strong> {{ date_time }}
                    </div>
                </div>
                <div class="footer-disclaimer">
                    This report is generated by the CIS Auditor Tool and provides an assessment of security controls 
                    based on Center for Internet Security (CIS) benchmarks. Results should be reviewed by qualified 
                    security professionals and validated in the context of your organization's security policies.
                </div>
            </div>
        </footer>
    </div>

    <script>
        // Enhanced filter functionality
        function filterResults() {
            const showPassed = document.getElementById('showPassed').checked;
            const showFailed = document.getElementById('showFailed').checked;
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            
            const rows = document.querySelectorAll('#resultsTable tbody tr');
            let visibleRows = 0;
            
            rows.forEach(row => {
                const isPassed = row.classList.contains('result-passed');
                const isFailed = row.classList.contains('result-failed');
                const rowText = row.textContent.toLowerCase();
                
                const statusVisible = (isPassed && showPassed) || (isFailed && showFailed);
                const searchMatch = searchTerm === '' || rowText.includes(searchTerm);
                const shouldShow = statusVisible && searchMatch;
                
                row.style.display = shouldShow ? '' : 'none';
                if (shouldShow) visibleRows++;
            });
            
            // Update filter feedback (optional)
            console.log(`Showing ${visibleRows} of ${rows.length} controls`);
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Add event listeners
            document.getElementById('showPassed').addEventListener('change', filterResults);
            document.getElementById('showFailed').addEventListener('change', filterResults);
            
            // Debounced search input
            let searchTimeout;
            document.getElementById('searchInput').addEventListener('input', function() {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(filterResults, 300);
            });

            // Animate compliance bar on load
            setTimeout(() => {
                const progressBar = document.querySelector('.compliance-fill');
                if (progressBar) {
                    progressBar.style.width = '{{ compliance_percentage }}%';
                }
            }, 500);
        });
    </script>
</body>
</html>
